---
title: "Intermediate analyses report - Tits reproduction study, PubPrivLands project (Martin *et al.*, *in prep.*)"
author: "Fran√ßois-Marie Martin"
date: "`r format(Sys.time(), '%d %B, %Y')`"
bibliography: ppl.tits_biblio.bib
csl: fanf_style.csl
output: rmdformats::readthedown
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

# IMPORTANT NOTE: if you read this, then you should know that this RMarkdown report has been written as a 'target' in a {targets} pipeline (https://books.ropensci.org/targets/). If you simply want to knit this report, you need to do it using using 'targets::tar_make()' (provided that you did not altered the structure of the "ppl.tits" folder to which this report belongs), otherwise it won't work! Alternatively, you can paste this .Rmd at the root of the "ppl.tits" folder. If you want to run the code contained within the code chunks of this document WITHOUT knitting, then you need to set the working directory of this .Rmd document at the root of the "ppl.tits" folder using the global options of RStudio, 'setwd()', or 'knitr::opts_knit$set(root.dir = '~/')'. That is because R, RStudio or {knitr} do not seem to be able to find the "_targets" folder containing the targets that are called by my code chunks otherwise... By default, RMarkdown sets the working directory where the .Rmd file is stored, not at the root of the R project the report is a part of.
# Still, note that theoretically, you do not need to knit or modify this document as it is meant for reproducibility and you can simply read the .html file for that.
```

# 1. Introduction
## 1.1. Regarding reproductibility


In order to facilitate any attempt at reproducing this study, here is a depiction of the system information used to prepare and analyse the data from the PubPrivLands tits reproduction study (Martin *et al.* , *in prep.*).

```{r session information}
rm(list=ls())
sessionInfo()
```

All codes used in this study can furthermore be found here: https://github.com/mrelnoob/ppl.tits
\
\

## 1.2. What is this document about?
### 1.2.1. Presentation of the data processing methodology

In the context of the *tits reproduction study* of the PubPrivLands project, we undertook a complex data processing methodology that can be divided into **five stages**:

1. **Raw data acquisition and preparation** - This initial stage consists of all *raw* data acquisition through fieldwork, GIS or remote-sensing-based data generation, and database extractions as well as their initial *cleaning* and *formatting* to produce **raw datasets** (e.g. tits reproduction observations, environmental variables). This stage is globally described in the *Materials & Methods* section of the manuscript, and is thoroughly detailed in the **ppl_log.pdf** document (French only, see Supplementary Materials).
2. **Clean dataset generation** - This stage includes all basic *cleaning*, *wrangling*, *computing* and *formatting* required to obtain a **clean exploitable dataset**. This stage is documented in the `R` files of the `ppl.tits` package openly accessible at: https://github.com/mrelnoob/ppl.tits.
3. **Intermediate analyses** - This stage encompasses all analyses performed to enable the landscape scale habitat connectivity modelling for both tits species and compute connectivity metrics using the [Graphab](https://sourcesup.renater.fr/www/graphab/fr/home.html) software @graphab2021. Through this stage, the **final dataset** is generated (i.e. the *clean exploitable dataset* completed with *connectivity metrics*). This stage is described in the *Intermediate analyses report* (the present document).
4. **Exploratory Data Analyses** (EDA) - This stage describes all *EDA* and preliminary *assumption checks* made on the *final dataset* that are required to plan proper statistical analyses for hypotheses testing. This stage is described in the *Exploratory data analyses and preparation report*.
5. **Statistical analyses** - This last stage includes all statistical procedures meant to *test* our study hypotheses, *produce results* and *assess their reliability*. This stage is described in the *Statistical analyses report*.


### 1.2.2. Content of this report

This document presents all analyses related to the third stage of our data processing methodology, that is *intermediate analyses* designed to model the landscape scale **habitat connectivity modelling** for Great tits and Blue tits in our study area.
\
\

******

# 2. Local habitat quality modelling
## 2.1. Rationale

```{r data import, include=FALSE}
library(ppl.tits) # To be able to use pipes.
stab_r2plot <- targets::tar_read(RF_r2plot)
stab_varimplot <- targets::tar_read(RF_importanceplot)
# tits <- targets::tar_read(final_tdata) # I don't need data for now!
# As you can see, I import my data using 'targets'! If you are reading this report and don't know what it is or how I created and stored them, you should read the README or the _devhistory.R files available at https://github.com/mrelnoob/ppl.tits. 

.pardefault <- par() # To save the default graphical parameters (in case I want to restore them).
```

In order to model the habitat connectivity of our focal species with the Graphab software @graphab2021, we first have to approximate the *quality* of every habitat patches (i.e. patch capacity), hence enabling weighting the nodes of the graph. Usually, this habitat quality is simply approximated by the patch cover area. In this study, we tried to obtained a more meaningful proxy of habitat quality for tits by developing a model predicting the birds' *clutch size* using local environmental variables only, hence the denomination of "local habitat quality models", one for each species.  
Provided we could build *reliable* predictive models based on our nestbox data, the idea was to use these models to **interpolate** tits' potential *clutch size* for all habitat pixels of our landcover map of the study area, and then evaluate the potential accuracy gained from this procedure compared to the simple use of habitat patches cover area for connectivity metrics computation. 


## 2.2. Local habitat model for the Great tits (*Parus major*)
### 2.2.1. Model building

We built a Random Forest regression model @breiman2001 using the `randomForest` package @liaw2002. We used *clutch size* as a response variable and, as spatial interpolation was our goal, we only considered **spatially continuous variables** as predictors: .


